{"version":3,"file":"testUtils.module.js","sources":["../src/index.js"],"sourcesContent":["import { options } from 'preact';\n\n/**\n * Setup a rerender function that will drain the queue of pending renders\n * @returns {() => void}\n */\nexport function setupRerender() {\n\toptions.__test__previousDebounce = options.debounceRendering;\n\toptions.debounceRendering = cb => options.__test__drainQueue = cb;\n\treturn () => options.__test__drainQueue && options.__test__drainQueue();\n}\n\n/**\n * Run a test function, and flush all effects and rerenders after invoking it\n * @param {() => void} cb The function under test\n */\nexport function act(cb) {\n\tconst previousRequestAnimationFrame = options.requestAnimationFrame;\n\tconst rerender = setupRerender();\n\n\t/** @type {() => void} */\n\tlet flush, toFlush;\n\n\t// Override requestAnimationFrame so we can flush pending hooks.\n\toptions.requestAnimationFrame = (fc) => flush = fc;\n\n\t// Execute the callback we were passed.\n\tcb();\n\trerender();\n\n\twhile (flush) {\n\t\ttoFlush = flush;\n\t\tflush = null;\n\n\t\ttoFlush();\n\t\trerender();\n\t}\n\n\tteardown();\n\toptions.requestAnimationFrame = previousRequestAnimationFrame;\n}\n\n/**\n * Teardown test environment and reset preact's internal state\n */\nexport function teardown() {\n\tif (options.__test__drainQueue) {\n\t\t// Flush any pending updates leftover by test\n\t\toptions.__test__drainQueue();\n\t\tdelete options.__test__drainQueue;\n\t}\n\n\tif (typeof options.__test__previousDebounce !== 'undefined') {\n\t\toptions.debounceRendering = options.__test__previousDebounce;\n\t\tdelete options.__test__previousDebounce;\n\t}\n\telse {\n\t\toptions.debounceRendering = undefined;\n\t}\n}\n"],"names":["setupRerender","options","__test__previousDebounce","debounceRendering","cb","__test__drainQueue","act","flush","toFlush","previousRequestAnimationFrame","requestAnimationFrame","rerender","fc","teardown","undefined"],"mappings":"iCAMA,SAAgBA,WACfC,EAAQC,EAA2BD,EAAQE,kBAC3CF,EAAQE,2BAAoBC,UAAMH,EAAQI,EAAqBD,qBAClDH,EAAQI,GAAsBJ,EAAQI,KAO7C,SAASC,EAAIF,OAKfG,EAAOC,EAJLC,EAAgCR,EAAQS,sBACxCC,EAAWX,QAMjBC,EAAQS,+BAAyBE,UAAOL,EAAQK,GAGhDR,IACAO,IAEOJ,GACNC,EAAUD,EACVA,EAAQ,KAERC,IACAG,IAGDE,IACAZ,EAAQS,sBAAwBD,EAMjC,SAAgBI,IACXZ,EAAQI,IAEXJ,EAAQI,WACDJ,EAAQI,QAGgC,IAArCJ,EAAQC,GAClBD,EAAQE,kBAAoBF,EAAQC,SAC7BD,EAAQC,GAGfD,EAAQE,uBAAoBW"}